<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Audio Briefing</title>
  <style>
    :root {
      --bg: #070b16;
      --bg2: #0a1124;
      --card: rgba(20, 28, 48, 0.8);
      --card2: rgba(11, 16, 30, 0.9);
      --line: rgba(89, 116, 184, 0.25);
      --text: #ebf1ff;
      --muted: #9da8c4;
      --accent: #3360ff;
      --accent-soft: rgba(51, 96, 255, 0.25);
      --danger: #ff8e8e;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      min-height: 100%;
    }

    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      background:
        linear-gradient(rgba(10, 17, 36, 0.96), rgba(7, 11, 22, 0.96)),
        repeating-linear-gradient(
          90deg,
          rgba(90, 116, 184, 0.08) 0 1px,
          transparent 1px 38px
        ),
        repeating-linear-gradient(
          180deg,
          rgba(90, 116, 184, 0.06) 0 1px,
          transparent 1px 38px
        ),
        radial-gradient(circle at 40% 20%, #132546 0%, var(--bg2) 40%, var(--bg) 100%);
      padding: 24px 14px 40px;
      display: flex;
      justify-content: center;
    }

    .app {
      width: min(860px, 100%);
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 22px;
      color: #d5def3;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .logo {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      display: grid;
      place-items: center;
      font-weight: 800;
      background: linear-gradient(140deg, #3d6bff, #1b2c79);
      box-shadow: 0 8px 24px rgba(51, 96, 255, 0.35);
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .prev-link {
      display: inline-flex;
      align-items: center;
      min-height: 34px;
      padding: 7px 12px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(13, 20, 38, 0.7);
      color: #c8d7ff;
      text-decoration: none;
      font-size: 13px;
      line-height: 1.2;
      transition: border-color 0.15s ease, background 0.15s ease;
    }

    .prev-link:hover {
      border-color: rgba(110, 139, 221, 0.6);
      background: rgba(21, 31, 57, 0.9);
    }

    .hero {
      text-align: center;
      margin-bottom: 20px;
    }

    .badge {
      display: inline-block;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      letter-spacing: 0.12em;
      color: #b4c2ef;
      background: rgba(14, 23, 46, 0.82);
    }

    .date {
      margin: 16px 0 0;
      font-size: clamp(34px, 7vw, 72px);
      line-height: 1.03;
      letter-spacing: 0.04em;
      font-weight: 800;
    }

    .subtitle {
      margin-top: 12px;
      color: var(--muted);
      letter-spacing: 0.26em;
      font-size: 12px;
      text-transform: uppercase;
    }

    .card {
      border: 1px solid var(--line);
      border-radius: 24px;
      overflow: hidden;
      background: linear-gradient(170deg, var(--card), var(--card2));
      box-shadow: 0 26px 70px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
    }

    .card-main {
      padding: 20px;
    }

    .cover-wrap {
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(128, 147, 194, 0.2);
      background: linear-gradient(135deg, #3f4f7a 0%, #232d44 48%, #3a2f2b 100%);
      position: relative;
      aspect-ratio: 16 / 6;
      display: grid;
      place-items: center;
    }

    .cover-img {
      position: relative;
      z-index: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    .placeholder {
      position: relative;
      z-index: 0;
      display: grid;
      gap: 8px;
      place-items: center;
      color: #7d96ff;
      opacity: 0.75;
    }

    .cover-wrap.has-image::after {
      content: "";
      position: absolute;
      inset: 0;
      z-index: 1;
      pointer-events: none;
      background:
        linear-gradient(to bottom, rgba(6, 11, 24, 0.2), rgba(6, 11, 24, 0.36)),
        radial-gradient(circle at 50% 52%, rgba(23, 38, 86, 0.46), rgba(7, 12, 27, 0.1) 58%, rgba(7, 12, 27, 0.24));
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
    }

    .cover-overlay {
      position: absolute;
      left: 50%;
      top: 54%;
      transform: translate(-50%, -50%);
      z-index: 2;
      pointer-events: none;
      display: grid;
      gap: 8px;
      place-items: center;
      opacity: 0;
      transition: opacity 0.25s ease;
      text-shadow: 0 3px 16px rgba(7, 12, 26, 0.85);
      isolation: isolate;
    }

    .cover-wrap.has-image .cover-overlay {
      opacity: 0.98;
    }

    .cover-overlay .bars {
      gap: 6px;
      filter: drop-shadow(0 0 10px rgba(75, 116, 255, 0.55));
    }

    .cover-overlay .bars span {
      width: 9px;
      background: rgba(95, 129, 255, 0.98);
      box-shadow: 0 0 22px rgba(66, 108, 255, 0.65);
      transform-origin: center bottom;
      animation: coverWave 1.05s ease-in-out infinite alternate;
      animation-play-state: paused;
    }

    .cover-overlay-label {
      font-size: 22px;
      letter-spacing: 0.08em;
      font-weight: 700;
      color: rgba(218, 228, 255, 0.82);
      text-shadow: 0 2px 12px rgba(7, 12, 26, 0.6);
    }

    .cover-wrap.no-image .cover-overlay {
      opacity: 0;
    }

    .cover-wrap.is-playing .cover-overlay .bars span {
      animation-play-state: running;
    }

    .cover-overlay .bars span:nth-child(1) { animation-duration: 0.88s; animation-delay: -0.42s; }
    .cover-overlay .bars span:nth-child(2) { animation-duration: 1.02s; animation-delay: -0.66s; }
    .cover-overlay .bars span:nth-child(3) { animation-duration: 0.82s; animation-delay: -0.22s; }
    .cover-overlay .bars span:nth-child(4) { animation-duration: 1.18s; animation-delay: -0.84s; }
    .cover-overlay .bars span:nth-child(5) { animation-duration: 0.92s; animation-delay: -0.33s; }
    .cover-overlay .bars span:nth-child(6) { animation-duration: 1.14s; animation-delay: -0.74s; }
    .cover-overlay .bars span:nth-child(7) { animation-duration: 0.86s; animation-delay: -0.21s; }
    .cover-overlay .bars span:nth-child(8) { animation-duration: 1.06s; animation-delay: -0.57s; }
    .cover-overlay .bars span:nth-child(9) { animation-duration: 0.9s; animation-delay: -0.38s; }

    @keyframes coverWave {
      0% {
        transform: scaleY(0.5);
        opacity: 0.82;
      }
      100% {
        transform: scaleY(1.18);
        opacity: 1;
      }
    }

    .bars {
      display: flex;
      gap: 7px;
      align-items: end;
    }

    .bars span {
      width: 8px;
      background: #3561ff;
      border-radius: 8px;
      box-shadow: 0 0 18px rgba(53, 97, 255, 0.45);
    }

    .bars span:nth-child(1) { height: 20px; }
    .bars span:nth-child(2) { height: 33px; }
    .bars span:nth-child(3) { height: 25px; }
    .bars span:nth-child(4) { height: 42px; }
    .bars span:nth-child(5) { height: 29px; }
    .bars span:nth-child(6) { height: 36px; }
    .bars span:nth-child(7) { height: 22px; }
    .bars span:nth-child(8) { height: 30px; }
    .bars span:nth-child(9) { height: 16px; }

    .title {
      margin: 20px 0 8px;
      font-size: var(--title-size, clamp(28px, 5.8vw, 54px));
      line-height: 1.1;
      text-wrap: balance;
      word-break: keep-all;
    }

    .meta-line {
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 15px;
      letter-spacing: 0.04em;
    }

    .summary {
      margin: 0 0 18px;
      color: #bdc8e5;
      font-size: 15px;
      line-height: 1.55;
    }

    .player-wrap {
      padding: 14px 0 2px;
      border-top: 1px solid rgba(99, 121, 179, 0.2);
      border-bottom: 1px solid rgba(99, 121, 179, 0.2);
    }

    .native-audio {
      position: absolute;
      pointer-events: none;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .custom-player {
      display: grid;
      gap: 12px;
      border: 1px solid rgba(99, 121, 179, 0.3);
      border-radius: 16px;
      padding: 12px;
      background: rgba(13, 22, 43, 0.76);
    }

    .player-main {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 12px;
      align-items: center;
    }

    .play-btn {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: 1px solid rgba(94, 124, 211, 0.6);
      background: radial-gradient(circle at 30% 30%, #3f69ff, #1b2f81);
      color: #f0f5ff;
      font-size: 23px;
      line-height: 1;
      cursor: pointer;
      box-shadow: 0 12px 26px rgba(42, 77, 184, 0.42);
    }

    .timeline-wrap {
      display: grid;
      gap: 7px;
    }

    .timeline-head {
      display: flex;
      justify-content: space-between;
      color: #9ab0e8;
      font-size: 13px;
      letter-spacing: 0.03em;
    }

    .seek {
      width: 100%;
      margin: 0;
      accent-color: #3b64ff;
      cursor: pointer;
    }

    .player-sub {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }

    .field {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: #aabbe7;
      font-size: 13px;
    }

    .field select,
    .field input[type="range"] {
      background: rgba(16, 25, 47, 0.95);
      border: 1px solid rgba(88, 110, 167, 0.55);
      border-radius: 8px;
      color: #dce6ff;
      height: 30px;
      padding: 0 8px;
    }

    .field input[type="range"] {
      width: 132px;
      padding: 0;
      accent-color: #3b64ff;
    }

    .controls {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      appearance: none;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px 14px;
      background: rgba(19, 29, 52, 0.85);
      color: #d8e4ff;
      text-decoration: none;
      font-size: 14px;
      cursor: pointer;
      min-height: 40px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: border-color 0.15s ease, transform 0.15s ease;
    }

    .btn:hover {
      border-color: rgba(110, 139, 221, 0.6);
      transform: translateY(-1px);
    }

    .btn.primary {
      border-color: rgba(101, 130, 216, 0.55);
      background: linear-gradient(180deg, rgba(34, 58, 136, 0.8), rgba(20, 34, 78, 0.88));
    }

    .status {
      margin: 12px 0 4px;
      color: #9cb0e7;
      font-size: 13px;
      min-height: 20px;
    }

    .status.error {
      color: var(--danger);
    }

    .tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 14px 0 0;
      padding: 0;
      list-style: none;
    }

    .tags li {
      border: 1px solid rgba(101, 124, 184, 0.45);
      background: rgba(21, 32, 58, 0.65);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color: #bdd0ff;
      letter-spacing: 0.03em;
    }

    .card-footer {
      background: rgba(3, 8, 19, 0.55);
      border-top: 1px solid rgba(85, 109, 170, 0.23);
      padding: 14px 20px;
      color: #7e90c0;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .usage {
      margin-top: 18px;
      color: #8fa2d5;
      font-size: 13px;
      text-align: center;
    }

    code {
      background: rgba(18, 28, 50, 0.9);
      border: 1px solid rgba(85, 105, 160, 0.45);
      color: #dae5ff;
      padding: 2px 7px;
      border-radius: 8px;
    }

    @media (max-width: 640px) {
      body {
        padding: 18px 10px 30px;
      }

      .topbar {
        margin-bottom: 16px;
      }

      .logo {
        width: 30px;
        height: 30px;
        border-radius: 9px;
        font-size: 12px;
      }

      .card-main {
        padding: 14px;
      }

      .cover-wrap {
        aspect-ratio: 16 / 8;
      }

      .cover-overlay {
        top: 56%;
      }

      .cover-overlay-label {
        font-size: 16px;
      }

      .meta-line {
        font-size: 13px;
      }

      .prev-link {
        font-size: 12px;
        padding: 6px 10px;
      }

      .play-btn {
        width: 46px;
        height: 46px;
        font-size: 20px;
      }

      .player-main {
        grid-template-columns: 1fr;
      }

      .player-sub {
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <header class="topbar">
      <div class="brand">
        <div id="logoText" class="logo">TP</div>
        <span id="brandText">Daily Briefing</span>
      </div>
      <div class="actions">
        <a
          class="prev-link"
          href="https://soop2.tplinkdns.com/webhook/prev_newsletter"
          target="_blank"
          rel="noopener noreferrer"
        >이전 뉴스레터 보기</a>
      </div>
    </header>

    <section class="hero">
      <span id="buildLabel" class="badge">LIVE BUILD v4.2.0</span>
      <h1 id="dateText" class="date">0000-00-00</h1>
      <p id="subtitleText" class="subtitle">DAILY DEVELOPER BRIEFING</p>
    </section>

    <section class="card">
      <div class="card-main">
        <div class="cover-wrap no-image">
          <img id="coverImage" class="cover-img" alt="오디오 커버 이미지" />
          <div id="coverPlaceholder" class="placeholder" aria-hidden="true">
            <div class="bars">
              <span></span><span></span><span></span><span></span><span></span>
              <span></span><span></span><span></span><span></span>
            </div>
            <small>PODCAST</small>
          </div>
          <div class="cover-overlay" aria-hidden="true">
            <div class="bars">
              <span></span><span></span><span></span><span></span><span></span>
              <span></span><span></span><span></span><span></span>
            </div>
            <span class="cover-overlay-label">PODCAST</span>
          </div>
        </div>

        <h2 id="titleText" class="title">Daily Developer Briefing</h2>
        <p id="metaLine" class="meta-line">Episode #00 · Hosted by Newsletter</p>
        <p id="summaryText" class="summary">오늘의 기술 브리핑을 준비하는 중입니다.</p>

        <div class="player-wrap">
          <audio id="player" class="native-audio" preload="none">
            <source id="source" src="" type="audio/mpeg" />
            브라우저에서 오디오를 재생할 수 없습니다.
          </audio>
          <div class="custom-player" role="group" aria-label="오디오 플레이어">
            <div class="player-main">
              <button id="playPauseBtn" class="play-btn" type="button" aria-label="재생">▶</button>
              <div class="timeline-wrap">
                <div class="timeline-head">
                  <span id="currentTimeText">0:00</span>
                  <span id="totalTimeText">0:00</span>
                </div>
                <input id="seekBar" class="seek" type="range" min="0" max="1000" value="0" step="1" aria-label="재생 위치" />
              </div>
            </div>
            <div class="player-sub">
              <label class="field" for="speedSelect">
                <span>배속</span>
                <select id="speedSelect" aria-label="재생 속도">
                  <option value="0.75">0.75x</option>
                  <option value="1" selected>1.0x</option>
                  <option value="1.25">1.25x</option>
                  <option value="1.5">1.5x</option>
                  <option value="2">2.0x</option>
                </select>
              </label>
              <label class="field" for="volumeBar">
                <span>볼륨</span>
                <input id="volumeBar" type="range" min="0" max="1" step="0.01" value="1" aria-label="볼륨" />
              </label>
            </div>
          </div>
          <div class="controls">
            <a id="download" class="btn primary" href="#" rel="noopener">MP3 다운로드</a>
            <button id="shareBtn" class="btn" type="button">링크 복사</button>
          </div>
          <p id="status" class="status"></p>
        </div>

        <ul id="tags" class="tags"></ul>
      </div>

      <footer class="card-footer">
        <span id="footerNote"></span>
        <span id="durationText">--:--</span>
      </footer>
    </section>

    <p class="usage">
      사용법: <code>?date=YYYY-MM-DD</code> 예) <code>?date=2026-02-09</code>
    </p>
  </main>

  <script>
    function getTodayYmd() {
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth() + 1).padStart(2, "0");
      const d = String(now.getDate()).padStart(2, "0");
      return y + "-" + m + "-" + d;
    }

    function formatTime(seconds) {
      if (!Number.isFinite(seconds) || seconds < 0) {
        return "0:00";
      }
      const total = Math.floor(seconds);
      const m = Math.floor(total / 60);
      const s = String(total % 60).padStart(2, "0");
      return m + ":" + s;
    }

    function setStatus(message, isError) {
      statusEl.textContent = message;
      statusEl.classList.toggle("error", Boolean(isError));
    }

    function updatePlayPauseButton() {
      if (audioEl.paused) {
        playPauseBtnEl.textContent = "▶";
        playPauseBtnEl.setAttribute("aria-label", "재생");
      } else {
        playPauseBtnEl.textContent = "❚❚";
        playPauseBtnEl.setAttribute("aria-label", "일시정지");
      }
    }

    function updateCoverWavePlaying() {
      coverWrapEl.classList.toggle("is-playing", !audioEl.paused && !audioEl.ended);
    }

    function syncTimeUi() {
      const duration = Number.isFinite(audioEl.duration) ? audioEl.duration : 0;
      const current = Number.isFinite(audioEl.currentTime) ? audioEl.currentTime : 0;
      currentTimeTextEl.textContent = formatTime(current);
      totalTimeTextEl.textContent = formatTime(duration);
      if (duration > 0) {
        seekBarEl.value = String(Math.round((current / duration) * 1000));
        if (durationTextEl.dataset.metaDuration !== "1") {
          durationTextEl.textContent = formatTime(duration);
        }
      } else {
        seekBarEl.value = "0";
      }
    }

    function updateTitleScale() {
      if (!titleTextEl) {
        return;
      }

      const textLength = titleTextEl.textContent.trim().length || 1;
      const containerWidth = titleTextEl.parentElement ? titleTextEl.parentElement.clientWidth : titleTextEl.clientWidth;
      const isMobile = window.matchMedia("(max-width: 640px)").matches;
      const minSize = isMobile ? 26 : 30;
      const maxSize = isMobile ? 44 : 56;
      let size = maxSize;

      if (textLength > 20) size -= 6;
      if (textLength > 32) size -= 7;
      if (textLength > 45) size -= 7;
      if (textLength > 60) size -= 4;

      size = size * Math.min(1.12, Math.max(0.74, containerWidth / 620));
      size = Math.max(minSize, Math.min(maxSize, size));

      titleTextEl.style.setProperty("--title-size", size.toFixed(1) + "px");

      const maxLines = isMobile ? 3.9 : 3.3;
      let adjustCount = 0;
      while (adjustCount < 28 && size > minSize) {
        const maxHeight = size * 1.1 * maxLines;
        if (titleTextEl.scrollHeight <= maxHeight) {
          break;
        }
        size -= 1;
        titleTextEl.style.setProperty("--title-size", size.toFixed(1) + "px");
        adjustCount += 1;
      }
    }

    function renderTags(tagList) {
      tagsEl.innerHTML = "";
      const tags = Array.isArray(tagList) ? tagList : [];
      if (!tags.length) {
        return;
      }
      for (const tag of tags) {
        const li = document.createElement("li");
        li.textContent = String(tag);
        tagsEl.appendChild(li);
      }
    }

    function applyCoverImage(url) {
      if (typeof url === "string" && url.trim()) {
        coverImageEl.src = url;
        coverImageEl.style.display = "block";
        coverPlaceholderEl.style.display = "none";
        coverWrapEl.classList.add("has-image");
        coverWrapEl.classList.remove("no-image");
        return;
      }
      coverImageEl.removeAttribute("src");
      coverImageEl.style.display = "none";
      coverPlaceholderEl.style.display = "grid";
      coverWrapEl.classList.remove("has-image");
      coverWrapEl.classList.add("no-image");
    }

    function applyMeta(meta) {
      const safe = meta && typeof meta === "object" ? meta : {};

      const brand = safe.brand || "Daily Briefing";
      const buildLabel = safe.buildLabel || "LIVE BUILD v4.2.0";
      const title = safe.title || "Daily Developer Briefing";
      const subtitle = safe.subtitle || "DAILY DEVELOPER BRIEFING";
      const episode = safe.episode || "#00";
      const host = safe.host || brand;
      const hasDuration = typeof safe.duration === "string" && safe.duration.trim().length > 0;
      const duration = hasDuration ? safe.duration : "--:--";
      const summary = safe.summary || "오늘의 기술 브리핑을 준비하는 중입니다.";
      const footerNote = safe.footerNote || "";
      const logoText = safe.logoText || "DB";

      brandTextEl.textContent = brand;
      buildLabelEl.textContent = buildLabel;
      titleTextEl.textContent = title;
      subtitleTextEl.textContent = subtitle;
      metaLineEl.textContent = "Episode " + episode + " · Hosted by " + host;
      summaryTextEl.textContent = summary;
      footerNoteEl.textContent = footerNote;
      durationTextEl.textContent = duration;
      durationTextEl.dataset.metaDuration = hasDuration ? "1" : "0";
      logoTextEl.textContent = logoText;

      renderTags(safe.tags);
      applyCoverImage(safe.coverImage);
      requestAnimationFrame(updateTitleScale);
    }

    const params = new URLSearchParams(window.location.search);
    const dateParam = params.get("date");
    const finalDate = (dateParam && /^\d{4}-\d{2}-\d{2}$/.test(dateParam)) ? dateParam : getTodayYmd();

    const base = "https://raw.githubusercontent.com/kimorkim/newsletter/main/";
    const audioUrl = base + "audio/" + finalDate + ".mp3";
    const metaUrl = base + "meta/" + finalDate + ".json";

    const dateTextEl = document.getElementById("dateText");
    const brandTextEl = document.getElementById("brandText");
    const logoTextEl = document.getElementById("logoText");
    const buildLabelEl = document.getElementById("buildLabel");
    const subtitleTextEl = document.getElementById("subtitleText");
    const titleTextEl = document.getElementById("titleText");
    const metaLineEl = document.getElementById("metaLine");
    const summaryTextEl = document.getElementById("summaryText");
    const tagsEl = document.getElementById("tags");
    const footerNoteEl = document.getElementById("footerNote");
    const durationTextEl = document.getElementById("durationText");
    const coverImageEl = document.getElementById("coverImage");
    const coverPlaceholderEl = document.getElementById("coverPlaceholder");
    const coverWrapEl = document.querySelector(".cover-wrap");
    const statusEl = document.getElementById("status");
    const audioEl = document.getElementById("player");
    const sourceEl = document.getElementById("source");
    const downloadEl = document.getElementById("download");
    const shareBtnEl = document.getElementById("shareBtn");
    const playPauseBtnEl = document.getElementById("playPauseBtn");
    const currentTimeTextEl = document.getElementById("currentTimeText");
    const totalTimeTextEl = document.getElementById("totalTimeText");
    const seekBarEl = document.getElementById("seekBar");
    const speedSelectEl = document.getElementById("speedSelect");
    const volumeBarEl = document.getElementById("volumeBar");

    dateTextEl.textContent = finalDate;
    sourceEl.src = audioUrl;
    downloadEl.href = audioUrl;
    audioEl.volume = Number(volumeBarEl.value);
    audioEl.playbackRate = Number(speedSelectEl.value);
    audioEl.load();
    updatePlayPauseButton();
    updateCoverWavePlaying();
    syncTimeUi();
    updateTitleScale();

    const canonicalUrl = new URL(window.location.href);
    canonicalUrl.searchParams.set("date", finalDate);

    shareBtnEl.addEventListener("click", async function () {
      const link = canonicalUrl.toString();
      try {
        await navigator.clipboard.writeText(link);
        setStatus("공유 링크를 복사했습니다.", false);
      } catch (error) {
        setStatus("클립보드 복사에 실패했습니다. 링크: " + link, true);
      }
    });

    playPauseBtnEl.addEventListener("click", async function () {
      try {
        if (audioEl.paused) {
          await audioEl.play();
        } else {
          audioEl.pause();
        }
      } catch (error) {
        setStatus("재생을 시작하지 못했습니다. 브라우저 권한을 확인해 주세요.", true);
      }
    });

    seekBarEl.addEventListener("input", function () {
      if (!Number.isFinite(audioEl.duration) || audioEl.duration <= 0) {
        return;
      }
      const nextTime = (Number(seekBarEl.value) / 1000) * audioEl.duration;
      audioEl.currentTime = nextTime;
      syncTimeUi();
    });

    speedSelectEl.addEventListener("change", function () {
      audioEl.playbackRate = Number(speedSelectEl.value);
    });

    volumeBarEl.addEventListener("input", function () {
      audioEl.volume = Number(volumeBarEl.value);
    });

    audioEl.addEventListener("loadedmetadata", function () {
      syncTimeUi();
      setStatus("재생 준비 완료: " + finalDate, false);
    });

    audioEl.addEventListener("timeupdate", function () {
      syncTimeUi();
    });

    audioEl.addEventListener("play", function () {
      updatePlayPauseButton();
      updateCoverWavePlaying();
    });

    audioEl.addEventListener("pause", function () {
      updatePlayPauseButton();
      updateCoverWavePlaying();
    });

    audioEl.addEventListener("ended", function () {
      updatePlayPauseButton();
      updateCoverWavePlaying();
      seekBarEl.value = "0";
      currentTimeTextEl.textContent = "0:00";
    });

    audioEl.addEventListener("error", function () {
      setStatus("오디오를 불러오지 못했습니다. 파일 경로를 확인해 주세요.", true);
      updatePlayPauseButton();
      updateCoverWavePlaying();
    });

    coverImageEl.addEventListener("error", function () {
      applyCoverImage("");
    });

    let resizeTimer = null;
    window.addEventListener("resize", function () {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(updateTitleScale, 100);
    });

    async function loadMeta() {
      setStatus("메타데이터 로딩 중...", false);
      try {
        const response = await fetch(metaUrl, { cache: "no-store" });
        if (!response.ok) {
          throw new Error("HTTP " + response.status);
        }
        const data = await response.json();
        applyMeta(data);
        setStatus("메타데이터 로딩 완료: " + finalDate, false);
      } catch (error) {
        applyMeta({});
        setStatus("메타데이터가 없어 기본 정보로 표시합니다. (" + finalDate + ")", false);
      }
    }

    loadMeta();
  </script>
</body>
</html>
